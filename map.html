<!DOCTYPE html>
<html>

<head>
    <title>CRS.Simple example - Leaflet</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>
    <script src="js/coords.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>


    <script src="js/buffer.js"></script>
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
        }

        #map {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>

<body>

    <div id='map'></div>
    <script>

        const imageSquareSize = 9560;

        //for development only 
        const params = new Proxy(new URLSearchParams(window.location.search), {
            get: (searchParams, prop) => searchParams.get(prop),
        });
        const dev = params.dev;

        const mainData = {
            data: {},
            markers: []
        };
        const img = {
            x: imageSquareSize,  // original width of image 
            y: imageSquareSize   // original height of image
        }

        // create the map
        var map = L.map('map', {
            // crs: L.CRS.Simple,
            maxZoom: 6,
            minZoom: 3,
            zoomControl: false,
            //preferCanvas: true,
            noWrap: true,
            edgeBufferTiles: 20,
            //inertia: false
        })

        var rc = new L.RasterCoords(map, [img.x, img.y])

        var mapBounds = new L.LatLngBounds(
            rc.unproject([1, imageSquareSize], 8),
            rc.unproject([imageSquareSize, 1], 8)
        );

        map.setMaxBounds([
            rc.unproject([1, imageSquareSize], 8),
            rc.unproject([imageSquareSize, 1], 8)
        ])

        // assign map and image dimensions
        map.setView(rc.unproject([img.x / 2, img.y / 2]), 2)

        const tileLayer = L.tileLayer('tiles/new/{z}/{x}/{y}.png', {
            noWrap: true,
            preferCanvas: true,
            bounds: mapBounds
        }).addTo(map)

        L.control.zoom({ position: 'topright' }).addTo(map);
        const label = L.marker(rc.unproject([img.x / 2, img.y / 2])).addTo(map)


    </script>
</body>

</html>